function init(){Element.addMethods({removeAllChildren:function(a){a=$(a);if(a!==undefined&&a!==null){while(a.hasChildNodes()){a.removeChild(a.firstChild)}}return a}});Element.addMethods({pullText:function(b){var a;b=$(b);if(b!==undefined&&b!==null){if(b.innerText){a=b.innerText}else{a=b.textContent}}return a}});$$("span[real]").collect(function(a){a.stress=""});$("toggle-discrepancies").toggle()}function switchstress(a){realsyllable=$("prosody:real:"+a.id.substring(15));if(realsyllable.stress=="-"||realsyllable.stress==""){new Effect.Opacity($(a),{from:0,to:1,duration:0.4});a.removeAllChildren();a.appendChild(marker(realsyllable));realsyllable.stress="+"}else{if(realsyllable.stress=="+"){new Effect.Opacity($(a),{from:1,to:0,duration:0.4});setTimeout(function(){a.removeAllChildren();a.appendChild(slackmarker(realsyllable));realsyllable.stress="∪"},150);new Effect.Opacity($(a),{from:0,to:1,duration:0.4})}else{new Effect.Opacity($(a),{from:1,to:0,duration:0.4});setTimeout(function(){a.removeAllChildren();a.appendChild(placeholder(realsyllable));realsyllable.stress="-"},150)}}}function checkstress(a){debug("Entering checkstress("+a+")");var b=$("prosody:real:"+a).select("span[real]").pluck("stress").collect(function(c){return c.replace(/∪/,"-")}).join("");debug("past var answer");if(b.length!=$("prosody:real:"+a).select("span[real]").length){alert("An answer must be complete to be submitted. Please fill in a symbol over each syllable in this line.");return}debug("past if(answer.length)");new Ajax.Updater({success:"checkstress"+a},"checkscansion",{parameters:{answer:b,line:a,poem:$("title").text},method:"get",onComplete:function(){if($$("button.prosody-checkstress span[allowdis]").length==$$("button.prosody-checkstress").length){$("toggle-discrepancies").toggle()}updatehintbutton(a)}})}function switchfoot(a){if($(a).select("span").length>0){$(a).select("span")[0].remove()}else{$(a).appendChild(footmarker())}}function checkfeet(a){var b=$("prosody:real:"+a).select("span[real]").invoke("pullText").join("");new Ajax.Updater({success:"checkfeet"+a},"checkfeet",{parameters:{answer:b,line:a,poem:$("title").text},method:"get",onComplete:function(){updatehintbutton(a)}})}function checkmeter(b,c){var a=window.open("meter-popup.html?line="+b+"&linegroupindex="+c,"Check your meter, friend!","resizable=no,scrollbars=no,status=no,width=300,height=200")}function marker(b){var a=document.createElement("span");a.setAttribute("class","prosody-marker");if(b.innerText){if(b.innerText.length>1){spacer=" ".times(Math.floor(b.innerText.length/2));if(b.innerText.length>3){a.appendChild(document.createTextNode(spacer+"/"+spacer))}else{a.appendChild(document.createTextNode("/"+spacer))}}else{a.appendChild(document.createTextNode("/"))}}else{if(b.textContent.length>3){spacer=" ".times(Math.floor(b.textContent.length/2));a.appendChild(document.createTextNode(spacer+"/"+spacer))}else{a.appendChild(document.createTextNode("/"))}}return a}function slackmarker(b){var a=document.createElement("span");a.setAttribute("class","prosody-marker");if(b.innerText){if(b.innerText.length>1){spacer=" ".times(Math.floor(b.innerText.length/2));if(b.innerText.length>3){a.appendChild(document.createTextNode(spacer+"∪"+spacer))}else{a.appendChild(document.createTextNode("∪"+spacer))}}else{a.appendChild(document.createTextNode("∪"))}}else{if(b.textContent.length>3){spacer=" ".times(Math.floor(b.textContent.length/2));a.appendChild(document.createTextNode(spacer+"∪"+spacer))}else{a.appendChild(document.createTextNode("∪"))}}return a}function footmarker(){var a=document.createElement("span");a.setAttribute("class","prosody-footmarker");a.appendChild(document.createTextNode("|"));return a}function placeholder(b){var a=document.createElement("span");a.setAttribute("class","prosody-placeholder");if(b.innerText){spacer=" ".times(Math.floor(b.innerText.length))}else{spacer=" ".times(Math.floor(b.textContent.length))}a.appendChild(document.createTextNode(spacer));return a}function togglestress(){$$(".prosody-marker").invoke("toggle")}function toggledifferences(a){if(a.value=="off"){document.styleSheets[0].insertRule("span[discrepant] { color: #F0F055; }",0);a.value="on"}else{if(a.value=="on"){document.styleSheets[0].deleteRule(0);a.value="off"}}}function updatehintbutton(a){debug("Entering updatehintbutton("+a+")");e=$("displaynotebutton"+a);debug("	e = "+$("displaynotebutton"+a));debug(" e.firstDescendant() = "+$(e).firstDescendant());if($$("#checkstress"+a+" span[allowdis]").length>0){debug("	Passed test.");e.removeChild($(e).firstDescendant());e.appendChild(clickablehintimage());e.setAttribute("onclick","pophint(this)")}}function clickablehintimage(){debug("Entering clickablehintimage()");img=document.createElement("img");img.setAttribute("src","images/unclickablehint.png");debug("img = ");debug(img);return img}function pophint(a){linenumber=a.id.substring(17);hintp=$("hintfor"+linenumber);pop=window.open("","Hint for line "+linenumber,"menubar=no,scrollbars=yes,height=300,width=400");pop.document.body.setAttribute("style","background: #222;color: #fff;font-size: 14px;");pop.document.body.appendChild(pop.document.importNode(hintp,true))}function debug(a){if(debugflag){console.log(a)}};